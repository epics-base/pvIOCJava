<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>EPICS JavaIOC: channel Access</title>
</head>

<body>
<h1 style="text-align: center">EPICS JavaIOC: caV3<br />
Channel Access Version 3<br />
package: org.epics.ioc.caV3<br />
2009.07.23</h1>
CONTENTS 

<div class="toc">
<ul>
  <li><a href="#Overview">Overview</a></li>
  <li><a href="#Server">Server</a> 
    <ul>
      <li><a href="#Syntax">Syntax</a></li>
      <li><a href="#Options">Get and Put Options</a></li>
      <li><a href="#monitor">monitor options</a></li>
    </ul>
  </li>
  <li><a href="#Client">Client</a> 
    <ul>
      <li><a href="#Overview1">Overview</a></li>
      <li><a href="#Naming">Naming conventions.</a></li>
      <li><a href="#Data">Data Types Supported</a></li>
      <li><a href="#Semantics">Semantics</a> 
        <ul>
          <li><a href="#Connection">Connection Semantics</a></li>
          <li><a href="#Process">Process Semantics</a></li>
          <li><a href="#Semantics1">Put Semantics</a></li>
          <li><a href="#Semantics2">Get Semantics</a></li>
          <li><a href="#PutGet">PutGet Semantics</a></li>
          <li><a href="#Monitor">Monitor Semantics</a></li>
        </ul>
      </li>
      <li><a href="#Implementa">Implementation Overview</a></li>
    </ul>
  </li>
</ul>
</div>
<hr />

<h2 style="text-align: center" id="Overview">Overview</h2>
<hr />

<p>This package provides support for Channel Access Version 3. The server
allows an existing Channel Access client to access a javaIOC database. The
client allows the javaIOC to communicate with a Version 3 server, e.g. a
javaIOC database can have links to records in a V3 IOC database.</p>

<p>In order to be available to a javaIOC, each must be started via the
factory provided be each. This is just a call to the start method. For
example:</p>
<pre>    org.epics.ioc.caV3.ClientFactory.start();</pre>

<p>The client must be started before the IOC is started and the server after.
The javaIOC overview provides instructions for using XMLToDatabase to start
everything.</p>

<p>Both the client and server use the JCA/CAJ support provided by <a
href="http://jca.cosylab.com">cosylab</a>. In addition the server uses the
CAS support that comes with the latest versions of JCA/CAJ.</p>
<hr />

<h2 style="text-align: center" id="Server">Server</h2>
<hr />

<h3 id="Syntax">Syntax</h3>

<p>A V3 client can access any field of a javaIOC record that is a scalar, an
array of scalars, or an enumerated structure. A boolean field appears as a
DBR_ENUM with choices = {"false","true"}.</p>

<p>A pvName has the form:</p>
<pre>    recordName.name.name...{options}</pre>

<p>where</p>
<dl>
  <dt><span
  style="font-family: Courier New,Courier,monospace;">recordName</span></dt>
    <dd>The name of a javaIOC record</dd>
  <dt><span
  style="font-family: Courier New,Courier,monospace;">name.name...</span></dt>
    <dd>Each name is a fieldName or propertyName or index as described in
      package org.epics.ioc.pv. The final field must a scalar, an array of
      scalars, or an enumerated structure.</dd>
  <dt><span
  style="font-family: Courier New,Courier,monospace;">options</span></dt>
    <dd>options are of the form "name=value". The options are described
    below.</dd>
</dl>

<p>The following examples use the channel access utility shell commands that
come with EPICS base. The database is the example/exampleDB.xml that comes
with the javaIOC. </p>
<pre>    caput double 6</pre>

<p>This writes the value 6 to the value field of a record named double.</p>
<pre>    caput double.{putProcess=true} 5</pre>

<p>This writes the value 5 to record double and also requests that the record
be processed. The value is written before the record is processed.</p>
<pre>     caget -d 20 double.{getProcess=true}</pre>

<p>This gets the value field of record double. The record is processed.</p>
<pre>    caput powerSupplyArray.supply.1.power{putProcess=true} 2</pre>

<p>This writes the value 2 to the power.value field of the second supply of
the powerSupplyArray record.</p>

<h3 id="Options">Get and Put Options</h3>

<p>The currently supported options are:</p>
<pre>    getProcess=true
    putProcess=true
    shareData=true</pre>

<p>getProcess processes the record and then retrives data. putProcess first
puts data into the record and then processes the record. In order for either
to work, the record must not already have a recordProcessor assigned to
it.</p>

<h3 id="monitor">monitor options</h3>

<p>Currently no options are supported. </p>
<hr />

<h2 style="text-align: center" id="Client">Client</h2>
<hr />

<h3 id="Overview1">Overview</h3>

<p>The client code implements a ChannelProvider that communicates with
Channel Access version 3 IOCs. It allows access to all the V3 data types. The
provider name is "caV3". </p>

<h3 id="Naming">Naming conventions.</h3>

<p>A PV Name (Process Variable Name) must be of the form:</p>
<pre>    recordName.fieldName{propertyList}</pre>

<p>where</p>
<dl>
  <dt>recordName</dt>
    <dd>Is the name of a record in a V3 IOC database.</dd>
  <dt>fieldName</dt>
    <dd>One of the following: 
      <dl>
        <dt>null</dt>
          <dd>Only the record name is specified. In this case the fieldName
            is assigned the name <span
            style="font-family: Courier New,Courier,monospace;">VAL</span>.</dd>
        <dt><span
        style="font-family: Courier New,Courier,monospace;">VAL</span></dt>
          <dd>In this case the remote (The V3) fieldName is <span
            style="font-family: Courier New,Courier,monospace;">VAL</span>
            and the javaIOC fieldName is <span
            style="font-family: Courier New,Courier,monospace;">value</span>.</dd>
        <dt><span
        style="font-family: Courier New,Courier,monospace;">value</span></dt>
          <dd>In this case the remote fieldName is <span
            style="font-family: Courier New,Courier,monospace;">VAL</span>
            and the javaIOC fieldName is <span
            style="font-family: Courier New,Courier,monospace;">value</span>.</dd>
        <dt><span
        style="font-family: Courier New,Courier,monospace;">value.index</span></dt>
          <dd>In this case the remote fieldName is <span
            style="font-family: Courier New,Courier,monospace;">VAL</span>
            and the javaIOC fieldName is <span
            style="font-family: Courier New,Courier,monospace;">value.index</span>
            . The DBR type will be DBR_INT and the Type will be pvInt. </dd>
        <dt><span
        style="font-family: Courier New,Courier,monospace;">value.choice</span></dt>
          <dd>In this case the remote fieldName is <span
            style="font-family: Courier New,Courier,monospace;">VAL</span>
            and the javaIOC fieldName is <span
            style="font-family: Courier New,Courier,monospace;">value.choice</span>
            . The DBR type will be DBR_STRING and the Type will be pvString.
          </dd>
        <dt>Anything else</dt>
          <dd>In this case both the remote and the javaIOC fieldName is
            whatever is specified. For example a fieldName of <span
            style="font-family: Courier New,Courier,monospace;">SCAN</span>
            can be specified. The name must be the name of a field in the V3
            record.</dd>
      </dl>
    </dd>
</dl>

<p>The propertyList is a comma separated list of property namesThe following
property names are supported.</p>
<dl>
  <dt><span
  style="font-family: Courier New,Courier,monospace;">alarm</span></dt>
    <dd>This provides access to the V3 status and severity. In the javaIOC
      the fields appear is a javaIOC alarm structure. </dd>
  <dt><span
  style="font-family: Courier New,Courier,monospace;">timeStamp</span></dt>
    <dd>This provides access to the V3 timeStamp. In the javaIOC the fields
      appear in a javaIOC timeStamp structure.</dd>
  <dt><span
  style="font-family: Courier New,Courier,monospace;">display</span></dt>
    <dd>This provides access to the V3 units, precision, lowerDisplayLimit,
      and upperDisplayLimit. The values appear in a javaIOC display
    structure.</dd>
  <dt><span
  style="font-family: Courier New,Courier,monospace;">control</span></dt>
    <dd>This provides access to the V3 lowerControlLimit and
      upperControlLimit. The values appear in a javaIOC control
    structure.</dd>
</dl>

<h3 id="Data">Data Types Supported</h3>

<p>The V3 data types are supported via a corresponding javaIOC data type. A
V3 <span style="font-family: Courier New,Courier,monospace;">char</span> is a
javaIOC <span
style="font-family: Courier New,Courier,monospace;">byte</span>. The types
<span style="font-family: Courier New,Courier,monospace;">short, int, float,
and doubl</span>e are common to both. A V3 <span
style="font-family: Courier New,Courier,monospace;">string</span> becomes a
javaIOC <span
style="font-family: Courier New,Courier,monospace;">String</span>. Arrays of
byte,short,...,string are also supported. A V3 <span
style="font-family: Courier New,Courier,monospace;">ENUM</span> becomes a
javaIOC enumerated structure. V3 properties (status, severity, timeStamp,
display limits, and control limits) become standard javaIOC structures
(alarm, timeStamp, display, and control).</p>

<p>This data is represented by what looks like a javaIOC record that has the
following structure:</p>
<pre>    record recordName structureName
         value fieldName
         alarm
         timeStamp
         display
         control</pre>

<p>where</p>
<dl>
  <dt>recordName</dt>
    <dd>The name of the V3 record.</dd>
  <dt>structureName</dt>
    <dd>This is always <span
      style="font-family: Courier New,Courier,monospace;">caV3</span></dd>
  <dt>value</dt>
    <dd>This is a javaIOC field that has a type corresponding to the V3 field
      type.</dd>
  <dt>fieldName</dt>
    <dd>This is value if the V3 field being accessed is <span
      style="font-family: Courier New,Courier,monospace;">VAL</span>.
      Otherwise it is the same as the V3 field name.</dd>
  <dt>alarm</dt>
    <dd>Present if the alarm propertyName was specified. It is the standard
      javaIOC alarm structure.</dd>
  <dt>timeStamp</dt>
    <dd>Present if the timeStamp propertyName was specified. It is the
      standard javaIOC timeStamp structure.</dd>
  <dt>display</dt>
    <dd>Present if the display propertyName was specified. It is the standard
      javaIOC display structure.</dd>
  <dt>control</dt>
    <dd>Present if the control propertyName was specified. It is the standard
      javaIOC control structure.</dd>
</dl>

<h3 id="Semantics">Semantics</h3>

<h4 id="Connection">Connection Semantics</h4>

<p>When a client makes a request to connect to a V3 channel, i.e. a
recordName.fieldName, the following occurs:</p>
<ul>
  <li>A JCA channel is created.</li>
  <li>When the JCA channel connects the JCA record is created.</li>
  <li>If display or control propertys are requested and/or the V3 field type
    is ENUM then a request is made to get values for them. This is done by
    issuing an appropriate DBR request type. For enum fields the choices are
    read. For display the units, precision, and display limits are read. For
    control the control limits are read.</li>
  <li>Only after all of the above completes is the client connected.</li>
</ul>

<h4 id="Process">Process Semantics</h4>

<p>If a process request is made than a put to the "PROC" field of the V3
record is made. This does not complete until the record has finished
processing.</p>

<h4 id="Semantics1">Put Semantics</h4>

<p>Propertys are ignored. If the fieldName has type ENUM then an int is
written, i.e. the index is modified. In all other cases the data type matches
the native data type. If the process option is specified than a process
request is made after the put completes. Note that this is normally not
required since a put to the VAL field of most V3 records results in the
record processing if the record is passive.</p>

<h4 id="Semantics2">Get Semantics</h4>

<p>All propertys are supported. If the fieldName has type ENUM then an int is
read, i.e. the index is read. In all other cases the requested data type
matches the native data type. If the process option is requested then a
process request is made before the get.</p>

<h4 id="PutGet">PutGet Semantics</h4>

<p>This results is a put request followed by a get request. If the process
option is specified then a process request is made between the put and the
get.</p>

<h4 id="Monitor">Monitor Semantics</h4>

<p>The propertys alarm and timeStamp are supported. If the fieldName has type
ENUM then an int is read, i.e. the index is read. In all other cases the
requested data type matches the native data type.</p>

<h3 id="Implementa">Implementation Overview</h3>

<p>The implementation consists of the following classes.</p>
<dl>
  <dt>ClientFactory</dt>
    <dd>This implements ChannelProvider. It creates instances of
      BaseV3Channel when a client calls createChannel. It creates a JCA
      Context that is used for all channels. It also listens for JCA Context
      Exceptions and Messages. In spawns a thread that issues a JCA poll
      request at regular intervals.</dd>
  <dt>BaseV3Channel</dt>
    <dd>This implements the Channel interface. It creates a JCA Channel and
      handles the JCA connection events. When a channel connects it creates a
      record by creating an instance of BaseV3ChannelRecord.</dd>
  <dt>BaseV3ChannelRecord</dt>
    <dd>This creates the JavaIOC record that corresponds to the V3 field and
      requested propertys. It reads the values for control and display. If
      the value field has type ENUM it reads the choices. It also has a
      method toRecord which takes the data returned by a JCA DBR request and
      puts the values into the JavaIOC record. This also posts data for
      monitoring.</dd>
  <dt>BaseV3ChannelProcess</dt>
    <dd>Implements a process request.</dd>
  <dt>BaseV3ChannelPut</dt>
    <dd>Implements a put request.</dd>
  <dt>BaseV3ChannelGet</dt>
    <dd>Implements a get request.</dd>
  <dt>BaseV3ChannelPutGet</dt>
    <dd>Implements a putGet request.</dd>
  <dt>BaseV3ChannelMonitor</dt>
    <dd>Implements a monitor request.</dd>
</dl>
</body>
</html>
