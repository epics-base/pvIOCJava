<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>EPICS JavaIOC: support</title>
</head>

<body>
<h1 style="text-align: center">EPICS JavaIOC: swtshell<br />
package: org.epics.ioc.swtshell<br />
2009.09.15</h1>

<p>CONTENTS</p>

<div class="toc">
<ul>
  <li><a href="#Overview">Overview</a></li>
  <li><a href="#Channel">Channel Access</a>
    <ul>
      <li><a href="#Getting">Getting a list of the channels in a
      javaIOC.</a></li>
      <li><a href="#Connecting">Connecting to a Channel</a></li>
      <li><a href="#Creating">Creating a Request</a></li>
      <li><a href="#process">process</a></li>
      <li><a href="#get">get</a></li>
      <li><a href="#put">put</a></li>
      <li><a href="#putGet">putGet</a></li>
      <li><a href="#array">array</a></li>
      <li><a href="#monitor">monitor</a></li>
    </ul>
  </li>
  <li><a href="#Local">Local JavaIOC</a>
    <ul>
      <li><a href="#loadDataba">loadDatabase</a></li>
      <li><a href="#introspect">introspectDatabase</a>
        <ul>
          <li><a href="#Database">Database Definitions</a></li>
          <li><a href="#Local1">Local Record Instance</a></li>
          <li><a href="#Show">Show Information</a></li>
        </ul>
      </li>
      <li><a href="#portDriver">portDriver</a></li>
    </ul>
  </li>
  <li><a href="#iocConsole">iocConsole</a></li>
</ul>
</div>

<p> </p>
<hr />

<h2 style="text-align: center" id="Overview">Overview</h2>
<hr />

<p>This package provides a GUI shell implemented via the SWT toolkit that
comes with eclipse. The default JavaIOC package overview document gives brief
instructions for starting the swtshell. If you want to communicate with
another javaIOC then the option "-server server/beforeStartCAV4.txt" must be
given when the javaIOC is started. If you want to communicate with a V3 EPICS
IOC then the option "-server server/beforeStartCAV3.txt" must be given. </p>

<p>The following window appears when swtshell is started:</p>

<center>
<p><img src="./swtshell.gif" alt="swtshell" /></p>
</center>

<p>The window has the following buttons:</p>
<ul>
  <li>channelList:<br />
    This obtains a list of the channels in a javaIOC. </li>
  <li>get, put, process, monitor, and array:<br />
    Each of these brings up another window which provides the ability to
    access data via channel access. The next section describes these
  windows:</li>
  <li>iocConsole<br />
    This provide a window which shows all messages sent to any record of the
    local javaIOC. This is shown in a later section.</li>
  <li>loadDatabase and introspectDatabase<br />
    Each of these buttons starts another window for interacting with the
    local javaIOC. They are described below.</li>
  <li>portDriver<br />
    Starts a window for interacting with a portDriver port and device.</li>
  <li>v3iocshell<br />
    The v3iocshell buttom starts a V3 epics ioc that is part of the same
    process as the javaIOC. In the future this will be used to communicate
    with asynDriver port drivers. For now this button is not documented. </li>
</ul>

<p><span style="font-weight:bold;">NOTE</span>: After text is typed into any
text input window, the enter key must be pressed.</p>
<hr />

<h2 style="text-align: center" id="Channel">Channel Access</h2>
<hr />

<p>The channelList, get, put, process, monitor, and array buttons each start
a new window. Each window provides the ability to connect to a PV (Process
Variable). </p>

<p>This window gets data from a local or remote IOC. The data is accessed via
Channel Access, which can be either V3 or V4 channelAccess</p>

<p>For EPICS V3 Channel Access only the following data can be accessed:</p>
<ul>
  <li>primitive data </li>
  <li>array of primitive data</li>
  <li>Channel Access V3 properties.</li>
</ul>

<p>See package org.epics.ioc.caV3 for details about caV3.</p>

<h3 id="Getting">Getting a list of the channels in a javaIOC.</h3>

<p>This obtains a list of a subset, selected by a regular expression, of the
records in a javaIOC. A name can be selected and dropped into a connect
window descibed in the next sub-section.</p>

<p>When channelList is selected from the main swtshell window the following
window appears.</p>

<center>
<p><img src="./channelList.gif" alt="channelList" /></p>
</center>

<p>The provider is normally CAV4 but could also be selected as local, i.e.
the javaIOC that is in the same process as swtshell. The icname must be
specified. A regular expression selects the set of records to list. The above
example selects all records with names ending in "RPC". The default regular
expression ".*" selects all records. When the enter key is pressed in the
regularExpression, the list of channels is read via channel access.</p>

<p>The implementation issues a channel access putGet request to get the
channel list It requres that the javaIOC have an RPC record ( RPC records are
descibed below) that provides the record list. The record must be named
"${IOCNAME}recordListRPC" where IOCNAME is the name of the javaIOC.</p>

<h3 id="Connecting">Connecting to a Channel</h3>

<p>The get, put, putGet, process, monitor, and array windows all have a
connect button. When this button is pressed the following window appears:</p>

<center>
<p><img src="./connectChannel.gif" alt="connectChannel" /></p>
</center>

<p>If selectLocalRecord is clicked then a list of all the records in the
local javaIOC is presented. When a record is selected a request is made to
create a channel connected to the record and control returned to the window
that has the connect button.</p>

<p>For a remote record a pvname can be entered. Note that the record name can
be obtained from the channelList described in the previous sub-section. When
return is given a request is made to create a channel to the selected record
and control returned to the window that has the connect button.</p>

<h3 id="Creating">Creating a Request</h3>

<p>The get, put, putGet and monotor windows all have a createRequest button,
which is activated after connecting to a channel. createRequest allows you to
select an arbitarary set of fields from the PVRecord to which the channel is
connected. When the createRequest button is pressed the following window
appears:</p>

<center>
<p><img src="./createRequest.gif" alt="createRequest" /></p>
</center>

<p>If shareData is selected then when a request is made it is a request for
shared data. This means that the server will share the scalar and array data
with the record itself instead of keeping a copy. If showRequest is selected
then when createRequest is done the created request structure is shown. A
request can be created via the createRequest button or by directly entering
the request in a text window.</p>

<p>When the createRequest button is clicked a window like the following
appears. The details depend on the record structure.</p>

<center>
<p><img src="./getSubSet.gif" alt="getSubSet" /></p>
</center>

<p>This window allows the user to select an arbitrary set of fields from the
PVRecord to which the channel is attached. When the arrow for a structure
field is clicked the fields for that structure appear. A field is selected by
clicking the button next to the field name. If a structure field is selected
the entire structure is selected.</p>

<p>A request can also be specified via a text window and then clicking the
request button. The rules for specifying the request via a text string are
specified by channel access but are repeated here. </p>

<p>ChannelAccess provides the method:</p>
<pre>    PVStructure createRequest(String structureName,String request);</pre>

<p>This creates a request structure. structureName will be the field name of
the PVStructure. request is of the form:</p>
<pre>    fieldDef,...,fieldDef</pre>

<p>That is request is a comma separated set of fieldDef which is of the
form:</p>
<pre>    fullFieldName</pre>
or 
<pre>    fieldName{request}</pre>

<p>A fullFieldName is the full name of a field in the PVRecord. The name in a
generated data structure will have just the field name. If fieldName{request}
is given then the generated data structure will have a structure field with
subfields defined by request. Note that request is a recursive definition.</p>

<p>A simple example is:</p>
<pre>    value,alarm,timeStamp</pre>

<p>This works if the record has top level fields named value, alarm, and
timeStamp.</p>

<p>An more complicated example is:</p>
<pre>    alarm,timeStamp,power{power.value,power.alarm},
    current{current.value,current.alarm},
    voltage{voltage.value,voltage.alarm}</pre>

<p>This works for the powerSupply example provided with the javaIOC test
examples.</p>

<h3 id="process">process</h3>

<p>The following window appears when the process button is pushed:</p>

<center>
<p><img src="./process.gif" alt="process" /></p>
</center>

<p>The connect button is for connecting and disconnecting to/from a channel.
The createProcess button is for creating and destroying a channelProcess
request. The process button sends a process request to the channel access
server.</p>

<h3 id="get">get</h3>

<p>Clicking the get button of the swtshell window creates the following
window. The following shows the window after connecting to a channel and
clicking createGet.:</p>

<center>
<p><img src="./get.gif" alt="get" /></p>
</center>

<p>The first row has the following widgets:</p>
<dl>
  <dt>conect</dt>
    <dd>This was described above. Note that after connecting to a channel the
      button becomes disconnect.</dd>
  <dt>process</dt>
    <dd>This says if a get is a get or a getProcess.</dd>
  <dt>createRequest</dt>
    <dd>This was described above.</dd>
  <dt>crateGet</dt>
    <dd>Create and destroy a channelGer request.</dd>
  <dt>get</dt>
    <dd>Issue a get request. The result is shown in the text window.</dd>
</dl>

<h3 id="put">put</h3>

<p>The following window appears when the put button is pushed:</p>

<center>
<p><img src="./put.gif" alt="put" /></p>
</center>

<p>Except for put the top row is just like get.</p>

<p>When the put button is clicked then what happens depends of how many
fields where selected from the PVRecord. If only a single scalar or array
field was selected, then a text entry box apppears. When a value is entered
and the return key is pressed then this value is sent via channel access.</p>

<p>If more than a single scalar or array field waas selected then when put is
clicked a window appears that allows the user to provide values to each
scalar or array field of the selected fields. This window is:</p>

<center>
<p><img src="./getValue.gif" alt="getValue" /></p>
</center>

<p>This display allows the user to give values to any of the scalar or array
fields.</p>

<p>If a primitive or array of primitives is selected then when edit is
clicked the following happens: </p>
<ul>
  <li>The text entry window shows the current value.</li>
  <li>After text is entered and the enter key presssed the data is put in the
    PVStructure created as a result of createRequest.</li>
</ul>

<p>When done is clicked the modified fields are sent to the channel access
server and written to the PVRecord.</p>

<h3 id="putGet">putGet</h3>

<p>The following window appears when the putGet button is pushed. It is
similar to get and put except that both a putRequest and a getRequest must be
specified.</p>

<center>
<p><img src="./putGet.gif" alt="putGet" /></p>
</center>

<p>A typical use of putGet is to issue the jacaIOC version of a remote
procedure call (RPC). An RPC record, by convention, has the following:</p>
<ol>
  <li>A top level feld named arguments.</li>
  <li>A top level field named result.</li>
  <li>Support that implements the RPC semantics.</li>
</ol>

<p>A client issues an RPC request as follows:</p>
<ol>
  <li>Gives values to the arguments.</li>
  <li>issues a putProcessGet</li>
  <li>Gets the result values.</li>
</ol>

<p>To use the putGet swt window to issue an RPC the client connects to a RPC
record, selects process, and for the createPutRequest selects arguments from
the following window.</p>

<center>
<p><img src="./RPCputRequest.gif" alt="RPCputRequest" /></p>
</center>

<p>Then result is selected from the createGetRequest window.</p>

<center>
<p><img src="./RPCgetRequest.gif" alt="RPCgetRequest" /></p>
</center>

<center>
<p>The following shows an example result.</p>

<p><img src="./putGet.gif" alt="putGet" /></p>
</center>

<h3 id="array">array</h3>

<p>The following window appears when the array button is pushed:</p>

<center>
<p><img src="./array.gif" alt="array" /></p>
</center>

<p>This window has a connect/disconnect button and a createArray/destroyArray
button. It has a text entry for subField. The get button issues a array get
request. The offset and count can be specified. The result is written into
the value field of the put row. The put button issues a put array request.
The offset can be specified. The value field provides the array values.</p>

<h3 id="monitor">monitor</h3>

<p>The following window appears when the monitor button is pushed:</p>

<center>
<p><img src="./monitor.gif" alt="monitor" /></p>
</center>

<p>The controls in the first row are similat to get and put.</p>

<p>The second row allows you to set the:</p>
<dl>
  <dt>queueSize</dt>
    <dd>The queue size. A value of 3 or more means that a queue will be kept
      on the server. A value of 2 is automatically set to 3. A value &lt;2
      means that no queue will be created on the server. Also if shareData
      was specified on createRequest than no queue is created. </dd>
  <dt>simulateDelay</dt>
    <dd>This is for testing channel access. If a non-zero value is specified
      a delay occurs after each monitor is received.</dd>
  <dt>onPut, ..., custom</dt>
    <dd>This is for specifying the algorithm that detemines when monitors are
      generated. If custom is selected the user must know the algoritm name
      and the format of a configuration structure for the algorithm. The
      javaIOC must have support registered for the selected algorithm. </dd>
  <dt>deadband</dt>
    <dd>A deadband to use if onAbsolute or onPercentage are seleccted.</dd>
  <dt>When start is clicked monitoring is started. It changes to a stop
  button while monitoring is active.</dt>
</dl>
<hr />

<h2 style="text-align: center" id="Local">Local JavaIOC</h2>
<hr />

<h3 id="loadDataba">loadDatabase</h3>

<p>The following window appears when the loadDatabase button is pushed:</p>

<center>
<p><img src="./loadDatabase.gif" alt="loadDatabase" /></p>
</center>

<p>This is used to load additional IOCDB definitions to a running IOC. It has
the following controls:</p>
<dl>
  <dt>find</dt>
    <dd>This brings up a file selection box that allows the selection of a
      DBD or DB file.</dd>
  <dt>show</dt>
    <dd>Lists the selected file.</dd>
  <dt>loadDB</dt>
    <dd>Adds definitions from the selected file to the JavaIOC file.
      Structure, create, and support definitions are added only if the file
      loads without error. It is an error if the definition already
    exists.</dd>
    <dd>Record instances are loaded, initialized, and started. If all of the
      new record instances are stated, then the records are added to ther
      master database. If any record fails to start, all the records are
      uinitialized and are not added to the master database.</dd>
</dl>

<h3 id="introspect">introspectDatabase</h3>

<p>The following window appears when the introspectDatabase button is
pushed:</p>

<center>
<p><img src="./introspectDatabase.gif" alt="introspectonsole" /></p>
</center>

<h4 id="Database">Database Definitions</h4>

<p>The top menubar allows the use to see all the structure definitions in the
master database.</p>

<h4 id="Local1">Local Record Instance</h4>

<p>The next three row allows the user to select and interact with a local
record. The select button is used to select a local record. The text window
after select shows the currently selected record and can also be used to
enter a record name. The remaining buttons apply to the selected button. They
are:</p>
<dl>
  <dt>dump</dt>
    <dd>shows the contents of the record.</dd>
  <dt>showState</dt>
    <dd>shows the state of the record.</dd>
  <dt>setTrace</dt>
    <dd>Allows the user to set trace on or off.</dd>
  <dt>setEnable</dt>
    <dd>Allows the use to set the enable state on or off.</dd>
  <dt>timeProcess</dt>
    <dd>Show how many times selected record can be processed per second.</dd>
  <dt>setSupportState</dt>
    <dd>Allows the use to issue a support state method, i.e. initialize,
      start, stop, or uninitialize.</dd>
  <dt>releaseProcessor</dt>
    <dd>Allows the use to force the release of the current record processor.
      This is a dangorous operation!!</dd>
</dl>

<h4 id="Show">Show Information</h4>

<p>The third row has two buttons that show information. They are:</p>
<dl>
  <dt>showBadRecords</dt>
    <dd>Show all records that havesomething out of ordinary. For example
      disabled, in alarm state, active, not ready.</dd>
  <dt>showThreads</dt>
    <dd>Shows all threads created via the thread utilities in package
      org.epics.ioc.util.</dd>
</dl>

<h3 id="portDriver">portDriver</h3>

<p>The following window appears when the portDriver button is pushed:</p>

<center>
<p><img src="./portDriver.gif" alt="portDriver" /></p>
</center>

<p>The first row has buttons to select a port and a device. The other rows
are for setting trace options and for connect and enable commands.</p>
<hr />

<h2 style="text-align: center" id="iocConsole">iocConsole</h2>
<hr />

<p>The following window appears when the iocConsole button is pushed:</p>

<center>
<p><img src="./iocConsole.gif" alt="iocConsole" /></p>
</center>

<p>When this is started, it calls iocdb.addRequester where iocdb is the
master IOCDB. Whenever any code sends a message to the iocdb, the message is
displayed on the iocConsole window. Note that iocdb puts the messages on a
queue and has a separate thead that send the messages to the requesters.</p>

<p></p>
</body>
</html>
