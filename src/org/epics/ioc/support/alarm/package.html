<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>EPICS JavaIOC: support</title>
</head>

<body>
<h1 style="text-align: center">EPICS JavaIOC: alarm support<br />
package: org.epics.ioc.alarm.support<br />
2010.01.08</h1>
CONTENTS 

<div class="toc">
<ul>
  <li><a href="#Overview">Overview</a></li>
  <li><a href="#definition">XML definitions For alarms</a>
    <ul>
      <li><a href="#Numeric">Numeric Scalar</a></li>
      <li><a href="#Boolean">Boolean</a></li>
      <li><a href="#Enumerated">Enumerated</a></li>
    </ul>
  </li>
  <li><a href="#Alarm">Alarm Support</a></li>
  <li><a href="#Value">Value Alarms</a>
    <ul>
      <li><a href="#Boolean1">Boolean Alarms</a></li>
      <li><a href="#Numeric1">Numeric Alarms</a></li>
      <li><a href="#Enumerated1">Enumerated Alarms</a></li>
    </ul>
  </li>
</ul>
</div>
<hr />

<h2 style="text-align: center" id="Overview">Overview</h2>
<hr />

<p>Support is provided for the alarm field itself and raising alarms for the
primitive types and for an enumerated structure.</p>

<p>The next section describes the xml syntax for attaching alarm support to a
value field and raising alarms for the value field. The remaining sections
describe the support. </p>

<p>An alarm is defind as follows:</p>
<pre>&lt;structure structureName = "alarm"&gt;
  &lt;scalar name = "severity" scalarType = "int" /&gt;
  &lt;scalar name = "message" scalarType = "string" /&gt;
&lt;/structure&gt;</pre>

<p>Thus an alarm is defined by a structure that has two fields:</p>
<dl>
  <dt>severity</dt>
    <dd>An integer that represents a severity index..
      org.epics.pvData.property has definitions for AlarmSeverity, Alarm, and
      AlarmFactory that implements a enum where the severity is the index.
    </dd>
  <dt>message</dt>
    <dd>A string field named message.</dd>
</dl>

<p>The following factories are provided:</p>
<dl>
  <dt>AlarmSupportFactory</dt>
    <dd>Complete support for field alarm.</dd>
  <dt>BooleanAlarmFactory</dt>
    <dd>Alarm support for boolean fields.</dd>
  <dt>ByteAlarmFactory</dt>
    <dd>Alarm support for byte fields.</dd>
  <dt>ShortAlarmFactory</dt>
    <dd>Alarm support for short fields.</dd>
  <dt>IntAlarmFactory</dt>
    <dd>Alarm support for int fields.</dd>
  <dt>LongAlarmFactory</dt>
    <dd>Alarm support for long fields.</dd>
  <dt>FloatAlarmFactory</dt>
    <dd>Alarm support for float fields.</dd>
  <dt>DoubleAlarmFactory</dt>
    <dd>Alarm support for double fields.</dd>
  <dt>EnumeratedAlarmFactory</dt>
    <dd>Alarm support for enum field..</dd>
</dl>
<hr />

<h2 style="text-align: center" id="definition">XML definitions For alarms</h2>
<hr />

<p>Support for raising alarms is provided for all the primitive types and for
an enumerated structure. Each can be defined for any field of a record that
has the corresponding type and has the field name "value". A record instance
can have multiple fields with associated alarm support. Since a structure can
have only one field named value, the top level of a structure can only have a
single alarm support but each substructure can also have alarm support. Three
basic types of support are provided: numeric, boolean, and enumerated. Each
is discussed in a separate section below.</p>

<h3 id="Numeric">Numeric Scalar</h3>

<p>Support is provided for all the numeric scalar types: byte, short, long,
float, and double. The following desription is for double but the support for
the other types is similar.</p>

<p>The structures associated with doubleAlarm are :</p>
<pre>&lt;structure structureName = "doubleAlarm" &gt;
  &lt;auxInfo name = "supportFactory" scalarType = "string"&gt;org.epics.ioc.doubleAlarmFactory&lt;/auxInfo&gt;
  &lt;scalar name = "active" scalarType = "boolean" /&gt;
  &lt;scalar name = "lowAlarmLimit" scalarType = "double" /&gt;
  &lt;scalar name = "lowWarningLimit" scalarType = "double" /&gt;
  &lt;scalar name = "highWarningLimit" scalarType = "double" /&gt;
  &lt;scalar name = "highAlarmLimit" scalarType = "double" /&gt;
  &lt;scalar name = "lowAlarmSeverity" scalarType = "int" /&gt;
  &lt;scalar name = "lowWarningSeverity" scalarType = "int" /&gt;
  &lt;scalar name = "highWarningSeverity" scalarType = "int" /&gt;
  &lt;scalar name = "highAlarmSeverity" scalarType = "int" /&gt;
  &lt;scalar name = "hystersis" scalarType = "double" /&gt;
&lt;/structure&gt;</pre>

<p>The doubleAlarm structure must appear in a structure at the same level as
a double scalar field named value. There must be an alarm field at the same
level.:q</p>

<p></p>

<p>An example for a double field is:</p>
<pre>&lt;record recordName = "simpleCounter" &gt;
    &lt;structure name = "alarm" extends = "alarm" /&gt;
    &lt;structure name = "timeStamp" extends = "timeStamp" /&gt;
    &lt;scalar name = "value" scalarType = "int" /&gt;
    &lt;structure name = "input" extends = "calculation" &gt;
      &lt;structure name = "calculator"&gt;
        &lt;scalar name ="expression"&gt;(value+1)&amp;lt;=10 ? value+1 : 0&lt;/scalar&gt;
      &lt;/structure&gt;
    &lt;/structure&gt;
    &lt;structure name = "valueAlarm" extends = "intAlarm"&gt;
      &lt;scalar name = "active"&gt;true&lt;/scalar&gt;
      &lt;scalar name = "lowAlarmLimit"&gt;2&lt;/scalar&gt;
      &lt;scalar name = "lowAlarmSeverity"&gt;2&lt;/scalar&gt;
      &lt;scalar name = "lowWarningLimit"&gt;4&lt;/scalar&gt;
      &lt;scalar name = "lowWarningSeverity"&gt;1&lt;/scalar&gt;
      &lt;scalar name = "highWarningLimit"&gt;8&lt;/scalar&gt;
      &lt;scalar name = "highWarningSeverity"&gt;1&lt;/scalar&gt;
      &lt;scalar name = "highAlarmLimit"&gt;10&lt;/scalar&gt;
      &lt;scalar name = "highAlarmSeverity"&gt;2&lt;/scalar&gt;
    &lt;/structure&gt;
&lt;/record&gt;</pre>

<p>This example reproduces the semantics of alarm support for an EPICS V3 ai
record but the details are different. The above xml definition is for a
record instance but it could also apply to a substructure of a record if
record is replaced by structure in the above example. What is important is
that the structure has fields named value and alarm and that a structure
field that extends doubleAlarm is defined.</p>

<h3 id="Boolean">Boolean</h3>

<p>A example of attaching alarm support to a boolean record or structure
is:</p>
<pre>&lt;record recordName = "booleanExample"&gt;
    &lt;scalar name = "value" scalarType = "boolean"/&gt;
    &lt;structure name = "alarm" extends = "alarm" /&gt;
    &lt;structure name = "timeStamp" extends = "timeStamp" /&gt;
    &lt;structure name = "valueAlarm" extends = "booleanAlarm"&gt;
      &lt;scalar name = "active"&gt;true&lt;/scalar&gt;
      &lt;scalar name = "falseSeverity"&gt;1&lt;/scalar&gt;
      &lt;scalar name = "trueSeverity"&gt;2&lt;/scalar&gt;
    &lt;/structure&gt;
&lt;/record&gt;</pre>

<p>The booleanAlarm structure also has a fields named changeOfStateAlarm and
changeOfStateMessage. It semantics should be easy to see.</p>

<h3 id="Enumerated">Enumerated</h3>

<p>Before explaining the example let's first define the structure associated
with enumerated alarm support.</p>
<pre>&lt;structure structureName = "enumeratedAlarm"&gt;
  &lt;auxInfo name = "supportFactory" scalarType = "string"&gt;org.epics.ioc.enumeratedAlarmFactory&lt;/auxInfo&gt;
  &lt;scalar name = "active" scalarType = "boolean" /&gt;
  &lt;array name = "stateSeverity" scalarType = "int" /&gt;
  &lt;scalar name = "changeStateSeverity" scalarType = "int" /&gt;
&lt;/structure&gt;</pre>

<p>An enumerated structure appears in a structure at the same level as an
enumerated field named value. It has the fields:</p>
<dl>
  <dt>active</dt>
    <dd>Is alarm processing active?</dd>
  <dt>stateSeverity</dt>
    <dd>An array of alarmSeverity values. There must be exactly 1 for each
      element of the value field.</dd>
  <dt>changeStateSeverity</dt>
    <dd>The alarm severity for change of state.</dd>
</dl>

<p>The following shows how to create a record with enumerated alarms.</p>
<pre>&lt;record recordName = "enumerated"&gt;
     &lt;structure name = "value" extends = "enumerated"&gt;
       &lt;array name = "choices"&gt;zero,one,two,three,four&lt;/array&gt;
    &lt;/structure&gt;
    &lt;structure name = "alarm" extends = "alarm" /&gt;
    &lt;structure name = "timeStamp" extends = "timeStamp" /&gt;
    &lt;structure name = "valueAlarm" extends = "enumeratedAlarm"&gt;
            &lt;scalar name = "active"&gt;true&lt;/scalar&gt;
            &lt;scalar name = "changeStateSeverity"&gt;0&lt;/scalar&gt;
            &lt;array name = "stateSeverity"&gt;2,1,0,1,2&lt;/array&gt;
    &lt;/structure&gt;

&lt;/record&gt;</pre>
<hr />

<h2 style="text-align: center" id="Alarm">Alarm Support</h2>
<hr />

<p>AlarmSupport is support for a field named which must have type structure
and the structure must be an alarm structure. Within the structure hierarchy
of a record multiple alarm fields can exist. Some support, e.g. generic,
calls the support for the alarm field defined in the top level structure
(defined in common.xml). If multiple alarm fields reside in a record then the
top level alarm field, which is what the outside world normally accesses has
a severity at least as great as any of the lower level alarms.</p>
<pre>interface AlarmSupport extends Support{
    void beginProcess();
    void endProcess();
    boolean setAlarm(String message, AlarmSeverity severity);
    Alarm getAlarm();
}

class AlarmSupportFactory {
    public static Support create(PVRecordStructure,pvRecordStructure)
    public static AlarmSupport getAlarmSupport(PVRecordField pvRecordField);
}</pre>

<p>AlarmSupport provides the methods:</p>
<dl>
  <dt style="font-family: courier;">Support</dt>
    <dd>Standard support methods..</dd>
  <dt style="font-family: courier;">beginProcess</dt>
    <dd>This is called when a field begins processing. It must be called by
      support for the structure that has alarm as a subfield. Support generic
      calls it.</dd>
  <dt style="font-family: courier;">endProcess</dt>
    <dd>This is called when a record finishes processing.It must be called by
      support for the structure that has alarm as a subfield. Support generic
      calls it. If setAlarm was not called since beginProcess was called than
      it makes sure that the severity is noAlarm. If the severity and/or
      message was changed during record processing it calls postPut.</dd>
  <dt style="font-family: courier;">setAlarm</dt>
    <dd>While a record is processing code, normally another support module,
      can call setAlarm. This method changes the new message and severity
      only if the severity passed to setAlarm is greater than the current new
      severity or if this is the first call since the record started
      processing.</dd>
  <dt style="font-family: courier;">getAlarm</dt>
    <dd>Get the Alarm interface. This interface is defined in
      org.epics.pvData.property.</dd>
</dl>

<p>AlarmFactory provides the static methods:</p>
<dl>
  <dt style="font-family: courier;">create</dt>
    <dd>Create support for a alarm field. This is called by
    SupportCreation.</dd>
  <dt style="font-family: courier;">getAlarmSupport</dt>
    <dd>Get the alarm support for the field or return null if none is
    found.</dd>
</dl>
<hr />

<h2 style="text-align: center" id="Value">Value Alarms</h2>
<hr />

<p>Support is provided for alarms for the following types of fields: boolean,
numeric, and enumerated.</p>

<h3 id="Boolean1">Boolean Alarms</h3>
<pre>    public class BooleanAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }</pre>

<p>This provides support for reporting alarms for boolean fields. The
configurationStructure must be a structure booleanAlarm, which has the
fields:</p>
<dl>
  <dt style="font-family: courier;">active</dt>
    <dd>A boolean field. If (false,true) then alarm conditions (are not,are)
      checked.</dd>
  <dt style="font-family: courier;">falseAlarm</dt>
    <dd>An alarmSeverity menu. This specifies the severity if the value field
      is false.</dd>
  <dt style="font-family: courier;">trueAlarm</dt>
    <dd>An alarmSeverity menu. This specifies the severity if the value field
      is true.</dd>
  <dt style="font-family: courier;">changeStateAlarm</dt>
    <dd>An alarmSeverity menu. This specifies the severity if the value field
      changes.</dd>
</dl>

<h3 id="Numeric1">Numeric Alarms</h3>
<pre>    public class ByteAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }
    public class ShortAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }
    public class IntAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }
    public class LongAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }
    public class FloatAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }
    public class DoubleAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }</pre>

<p>The above factories provide alarm support for the associated type of
field, e.g. FloatAlarmFactory provides alarm support for a field of type
float. The support for each type except that float and double also support
hystersis: If value goes into alarm this is the amount it must come out of
alarm before the alarm severity is modified. This prevents alarm .</p>

<h3 id="Enumerated1">Enumerated Alarms</h3>
<pre>    public class EnumeratedAlarmFactory {
        public static Support create(PVRecordStructure pvRecordStructure);
    }</pre>

<p>The above factory provides support for an enumerated structure field.</p>

<p>The enumeratedAlarm structure has the following fields:</p>
<dl>
  <dt style="font-family: courier;">active</dt>
    <dd>A boolean field. If (false,true) then alarm conditions (are not,are)
      checked.</dd>
  <dt style="font-family: courier;">stateSeverity</dt>
    <dd>An array of stateSeverity alarmSeverity menu definitions. When the
      process method is called the value field is the index for this array.
      The corresponding alarmSeverity menu is found and it determines the
      alarm severity.</dd>
  <dt style="font-family: courier;">changeStateAlarm</dt>
    <dd>An alarmSeverity menu. This specifies the severity if the value field
      changes.</dd>
</dl>
</body>
</html>
