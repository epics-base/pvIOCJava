<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>EPICS JavaIOC: portDriver VXI-11</title>
</head>

<body>
<h1 style="text-align: center">EPICS JavaIOC: portDriver VXI-11<br />
package: org.epics.ioc.pdrv.vxi11<br />
2009.03.23</h1>
CONTENTS 

<div class="toc">
<ul>
  <li><a href="#Overview">Overview</a></li>
  <li><a href="#Configurat">Configuration</a></li>
  <li><a href="#Implementa">Implementation</a></li>
</ul>
</div>
<hr />

<h2 style="text-align: center" id="Overview">Overview</h2>
<hr />

<p>NOTE: The GPIBController and GPIBDevice commands hane not been tested.
Only minimal testing has been done.</p>

<p>This package describes JavaIOC support for communication with devices that
are accessable via the VXI-11 communication protocal. The VXI-11 standard
consists of the following documents(PDF Format):</p>
<ol>
  <li><a href="vxi-11.pdf">TCP/IP Instrument Protocol Specification</a></li>
  <li><a href="vxi-11_1.pdf">TCP/IP-VXIbus Interface Specification</a></li>
  <li><a href="vxi-11_2.pdf">TCP/IP-IEEE 488.1 Interface
  Specification</a></li>
  <li><a href="vxi-11_3.pdf">TCP/IP-IEEE 488.2 Instrument Interface
    Specification</a></li>
</ol>

<p>The protocal use the SUN ONC RPC (Remote Procedure Call) network standard.
The complete VXI-11 ONC interface definition is provided in an appendix of
the Protocal Specification. The interface specifications appear in package
org.epics.ioc.pdrv.vxi11.rpc.</p>

<p><a href="http://remotetea.sourceforge.net">Remote Tea</a> is an open
sounce implementation of ONC RPC. The jar file for Remote Tea is included
with the Java IOC. Remote Tea was used to generate, from the ONC interface
definitions, the java files that appear in package
org.epics.ioc.pdrv.vxi11.rpc. </p>

<p>The code in this package provides a portDriver driver that uses Remote Tea
and the generated files to interface to VXI-11 devices. It implements the
following interfaces:</p>
<ul>
  <li>Octet<br />
    This is for I/O to/from VXI-11 devices.</li>
  <li>GpibController<br />
    If the deviceName refers to the controller itself then interface
    GpibController is implemented.</li>
  <li>GpibDevice<br />
    This is inplemented for each deviceName</li>
</ul>

<p>VXI-11 allows both primary (PAD) and secondary (SAD) addresses, each of
which must be an integer &gt;=0. The following conventions are used for
deviceNames:</p>
<ul>
  <li>PAD only device<br />
    The deviceName is a non-negative integer. Thus "0", "1", "15" are all
    legal device names.</li>
  <li>PAD and SAD device<br />
    The deviceName is of the form PAD,SAD. Thus "0,1" , "2,127", "4,0" are
    all legal device names.</li>
  <li>The controller itself<br />
    Any string that does not match the above choices. A good choice is
    "controller".</li>
</ul>
<hr />

<h2 style="text-align: center" id="Configurat">Configuration</h2>
<hr />

<p>A structure vxi11Driver defines fields for configuring a vxi11 driver.</p>
<pre>&lt;structure name = "vxi11Driver"&gt;
    &lt;scalar name = "hostName" type = "string" /&gt;
    &lt;scalar name = "vxiName" type = "string" /&gt;
    &lt;scalar name = "lockTimeout" type = "int" /&gt;
    &lt;scalar name = "eosInput" type = "string" /&gt;
    &lt;scalar name = "eosOutput" type = "string" /&gt;
&lt;/structure&gt;</pre>

<p>NOTE: The only value accepted for eosInput and eosOutput are NL, which is
a new line.</p>

<p>A record must be defined for each port to a vxi11 controller.</p>
<pre>&lt;record name = "???" type = "portCreate"&gt;
    &lt;scalar name = "factoryName"&gt;org.epics.ioc.pdrv.vxi11.DriverFactory&lt;/scalar&gt;
    &lt;scalar name = "portName"&gt;???&lt;/scalar&gt;
    &lt;structure name = "driverParameters" type = "vxi11Driver" &gt;
        &lt;scalar name = "hostName"&gt;???&lt;/scalar&gt;
        &lt;scalar name = "vxiName"&gt;???&lt;/scalar&gt;
        &lt;scalar name = "eosInput"&gt;????&lt;/scalar&gt;
        &lt;scalar name = "eosOutput"&gt;????&lt;/scalar&gt;
    &lt;/structure&gt;
&lt;/record&gt;</pre>

<p>The following example creates a port and a record instance that sends a
command to a GPIB device and reads the response, which is a string that has a
float value.</p>
<pre>&lt;record name = "serialPort" type = "portCreate"&gt;
    &lt;scalar name = "factoryName"&gt;org.epics.ioc.pdrv.vxi11.DriverFactory&lt;/scalar&gt;
    &lt;scalar name = "portName"&gt;serialPort&lt;/scalar&gt;

    &lt;structure name = "driverParameters" type = "vxi11Driver" &gt;
        &lt;scalar name = "hostName"&gt;192.168.1.10&lt;/scalar&gt;
        &lt;scalar name = "vxiName"&gt;hpib&lt;/scalar&gt;
    &lt;/structure&gt;
&lt;/record&gt;

&lt;record name = "serialToDouble"&gt;
    &lt;scalar name = "value" type = "double"/&gt;
    &lt;structure name = "alarm" type = "alarm" /&gt;
    &lt;structure name = "timeStamp" type = "timeStamp" /&gt;
    &lt;structure name = "link" type = "portDriverLink"&gt;
        &lt;scalar name = "portName"&gt;serialPort&lt;/scalar&gt;
        &lt;scalar name = "deviceName"&gt;3&lt;/scalar&gt;
        &lt;scalar name = "timeout"&gt;.2&lt;/scalar&gt;
        &lt;structure name = "command" type = "pdrvStringNoop"&gt;
            &lt;scalar name = "value"&gt;:FETC?&lt;/scalar&gt;
            &lt;structure name = "output" type = "pdrvOctetOutput"/&gt;
        &lt;/structure&gt;
        &lt;structure name = "input" type = "pdrvStringToScalar"&gt;
            &lt;structure name = "input" type = "pdrvOctetInput"/&gt;
        &lt;/structure&gt;
    &lt;/structure&gt;
&lt;/record&gt;</pre>
<hr />

<h2 style="text-align: center" id="Implementa">Implementation</h2>
<hr />

<p>The code consists of two implementation modules:</p>
<ul>
  <li>DriverFactory<br />
    This implemnents the portDriver interfaces: PortDriver, DeviceDriver,
    Octet, GpibController, and GpibDevice.</li>
  <li>VXI11Factory<br />
    This provides access to the RPC Java code created by Remote Tea.</li>
</ul>

<p>The code was split into two modules for code clarity. The design and even
some of the code was taken from Java code that Eric Norum implemented while
he was working at the Canadian Light Source.</p>
</body>
</html>
